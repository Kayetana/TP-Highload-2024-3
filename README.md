# Highload Twitter

## 1. Тема и целевая аудитория
Твиттер - сервис микроблогов и социальная сеть, в которой пользователи публикуют сообщения, известные как твиты.

### Целевая аудитория

Целевая аудитория Твиттера включает миллионы пользователей по всему миру.  

Топ-10 стран по месячной аудитории (MAU)  
_Данные основаны на показателях рекламных охватов Твиттера, опубликованных в апреле 2023 года._ [[1]](https://datareportal.com/essential-twitter-stats)

| Страна            | Пользователи |
|:------------------|:-------------|
| США               | 64.9 млн     |
| Япония            | 51.8 млн     |
| Бразилия          | 16.6 млн     |
| Великобритания    | 16.1 млн     |
| Индия             | 15.0 млн     |
| Индонезия         | 14.8 млн     |
| Турция            | 13.8 млн     |
| Мексика           | 11.8 млн     |
| Саудовская Аравия | 11.4 млн     |
| Франция           | 9.5 млн      |

### Ключевой функционал
- Регистрация и авторизация
- Публикация твитов
  - Твит может содержать текст до 280 символов (включая хештеги), фото и видео
  - Твит может быть либо отдельным твитом, либо ответом на другой твит
- Возможность лайкать и репостить твиты
- Поиск:
  - пользователей по юзернейму
  - твитов по хештегам
- Подписка на других пользователей
- Получение ленты
  - Лента формируется на основе подписок, активности пользователя, а также рекламы
  - Лента пополняется новыми твитами в реальном времени

## 2. Расчет нагрузки

### Продуктовые метрики

Все найденные метрики, которые будут использоваться в расчетах:
- Количество зарегистрированных пользователей: 1.3 млрд [[2]](https://www.demandsage.com/twitter-statistics/)
- Месячная аудитория (MAU): 528.3 млн [[2]](https://www.demandsage.com/twitter-statistics/)
- Дневная аудитория (DAU): 237.8 млн [[2]](https://www.demandsage.com/twitter-statistics/)
- Среднее время на сайте: 30.9 минут в день [[2]](https://www.demandsage.com/twitter-statistics/)
- 100 самых популярных аккаунтов имеют более 24 миллионов подписчиков [[3]](https://notcommon.com/most-followed/twitter)
- Количество твитов в день: 500 млн [[4]](https://blog.twitter.com/engineering/en_us/a/2013/new-tweets-per-second-record-and-how)

**_Основные метрики_**

| Метрика | Значение  |
|:--------|:----------|
| MAU     | 528.3 млн |
| DAU     | 237.8 млн |

**_Действия пользователя_**

Согласно статистике дневная аудитория Твиттера составляет 237.8 млн пользователей,
которые публикуют около 500 млн твитов. Получается, что один пользователь в среднем публикует 2 твита в день.  

Известно, что пользователь проводит в Твиттере около 30 минут в день.
Учитывая, что среди твитов попадаются видео, будем считать, что за одну минуту пользователь успевает просмотреть
около 10 твитов. Получаем 300 твитов в день.  
Также будем считать, что из всех просмотренных твитов, пользователь лайкает только пятую часть.

Поиск используется относительно редко, большую часть времени пользователи просматривают твиты из своей ленты,
поэтому будем считать, что этот функционал используется примерно 3 раза в неделю.

| Действие           | Кол-во |
|:-------------------|:-------|
| Просмотр твита     | 300    |
| Лайк твита         | 60     |
| Публикация твита   | 2      |
| Подписка           | 1      |
| Поиск по юзернейму | 0.4    |
| Поиск по хештегу   | 0.4    |

**_Размер хранилища_**

Твит может содержать текст, изображения и видео. Примерный размер этих данных:
- Текст = ~200 байт [[5]](https://www.slideshare.net/raffikrikorian/twitter-by-the-numbers)
- Изображение = ~1.2 Мб [[6]](https://gitnux.org/average-photo-size/)
- Видео = ~65 Мб  
(примерно такой размер имеет 30-секундное видео, снятое на айфон с разрешением 1080p HD и частотой кадров 30 fps
[[7]](https://www.lifewire.com/how-much-video-can-iphone-record-2000304))

Преобладающее большинство твитов содержат одну картинку или одно видео.
Однако твиты, публикующиеся в качестве комментариев, чаще всего не имеют вложений.
Будем считать, что:
- 100% твитов содержат текст
- 40% твитов содержат одну картинку и текст
- 5% твитов содержат одно видео и текст

Пользователь в среднем публикует 2 твита в день, это 730 текстовых твитов в год,
730 * 0.4 изображений и 730 * 0.05 видео. С учетом этого составим таблицу.

| Тип данных  | Кол-во за год | Размер за год | Кол-во за 5 лет | Размер за 5 лет |
|:------------|:--------------|:--------------|:----------------|:----------------|
| Текст       | 730           | 0.146 Мб      | 3650            | 0.0007 Гб       |
| Изображение | 292           | 350 Мб        | 1460            | 1.75 Гб         |
| Видео       | 37            | 2405 Мб       | 185             | 12 Гб           |

```Всего за год: ~2.75 Гб на одного пользователя```  
```Всего за 5 лет: ~13.75 Гб на одного пользователя```

### Технические метрики

#### Размер хранения данных (в штуках и в Тб)

```
(500 000 000 твитов/сутки * 365 дней = 182 500 000 000 твитов/год
(182 500 000 000 твитов/год) * 300 Кб = 54 750 Тб в год
```

#### RPS по основным типам запросов

_Твиты_
```
RPS = (500 000 000 твитов/день) / (24 * 60 * 60) = ~5790
```

_Лайки_
```
237 800 000 польз. * 10 лайков/день = 2 378 000 000 лайков/день
RPS = (2 378 000 000 лайков/день) / (24 * 60 * 60) = ~27500
```

_Поиск по хештегам_
```
237 800 000 польз. * 0.57 поисков/день = 135 546 000 поисков/день
RPS = (135 546 000 поисков/день) / (24 * 60 * 60) = ~1570
```

_Подписки_
```
237 800 000 польз. * 1 подписка/день = 237 800 000 подписок/день
RPS = (237 800 000 подписок/день) / (24 * 60 * 60) = ~2750
```

| Действие         | RPS   |
|:-----------------|:------|
| Твит             | 5790  |
| Лайк             | 27500 |
| Поиск по хештегу | 1570  |
| Подписка         | 2750  |

#### Сетевой трафик

- Пиковое потребление сетевого трафика в течение суток (в Гбит/с)
```
5790 твитов/с * 300 Кб = 1 737 000 Кб/c = ~13.9 Гбит
```
- Суммарный суточный сетевой трафик (Гбайт/сутки)
```
(500 000 000 твитов/сутки) * 300 Кб = 150 000 000 000 Кб = ~150 000 Гб в сутки
```

## Источники
1. https://datareportal.com/essential-twitter-stats
2. https://www.demandsage.com/twitter-statistics/
3. https://notcommon.com/most-followed/twitter
4. https://blog.twitter.com/engineering/en_us/a/2013/new-tweets-per-second-record-and-how
5. https://www.slideshare.net/raffikrikorian/twitter-by-the-numbers
6. https://gitnux.org/average-photo-size/
7. https://www.lifewire.com/how-much-video-can-iphone-record-2000304
